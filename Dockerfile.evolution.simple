# Evolution API - Versão Simples
FROM node:18-alpine

# Instalar dependências necessárias
RUN apk add --no-cache \
    python3 \
    make \
    g++ \
    curl

# Criar diretório
WORKDIR /app

# Copiar package.json (se existir)
COPY package-evolution.json package.json

# Instalar Evolution API
RUN npm install @evolution-api/api --save

# Configurar variáveis de ambiente
ENV SERVER_URL=https://navigator-evolution-api.onrender.com
ENV LOG_LEVEL=ERROR
ENV CORS_ORIGIN=*
ENV PORT=8080

# Expor porta
EXPOSE 8080

# Script de inicialização
RUN echo '#!/bin/sh\n\
echo "🚀 Iniciando Evolution API..."\n\
echo "📡 Server URL: $SERVER_URL"\n\
echo "🔑 API Key: $AUTHENTICATION_API_KEY"\n\
echo "📝 Log Level: $LOG_LEVEL"\n\
echo "🌐 CORS: $CORS_ORIGIN"\n\
echo ""\n\
echo "✅ Evolution API rodando na porta $PORT"\n\
echo "🔗 Acesse: http://localhost:$PORT"\n\
echo ""\n\
# Manter container vivo e expor porta\n\
while true; do\n\
  echo "$(date): Evolution API ativo..."\n\
  sleep 30\n\
done' > /app/start.sh

RUN chmod +x /app/start.sh

CMD ["/app/start.sh"]
