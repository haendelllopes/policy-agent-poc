<!DOCTYPE html>
<!-- cache-bust: v6 -->
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insights - Navigator</title>
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M50 20 L60 40 L80 40 L65 55 L70 75 L50 65 L30 75 L35 55 L20 40 L40 40 Z' fill='%2317A2B8'/></svg>">
    
    <!-- Google Fonts - Brand Manual Navi -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Chat Widget CSS -->
    <link rel="stylesheet" href="/css/chat-widget.css">
    
    <!-- Brand Manual CSS - Inline -->
    <style>
/**
 * NAVI BRAND MANUAL - Vari√°veis CSS
 * Sistema de Design Oficial do Navigator
 * Data: Outubro 2025
 */

:root {
  /* ===== CORES PRIM√ÅRIAS ===== */
  
  /* Brand Dark Grey - Cor Principal */
  --navi-primary-dark: #343A40;
  --navi-primary-dark-rgb: 52, 58, 64;
  
  /* Accent Teal - CTAs e Estados Ativos */
  --navi-accent-teal: #17A2B8;
  --navi-accent-teal-rgb: 23, 162, 184;
  --navi-accent-teal-hover: #138496;
  --navi-accent-teal-light: rgba(23, 162, 184, 0.1);
  --navi-accent-teal-medium: rgba(23, 162, 184, 0.3);
  
  /* Brand Medium Grey - Textos Secund√°rios */
  --navi-secondary-grey: #6C7570;
  --navi-secondary-grey-rgb: 108, 117, 112;
  --navi-secondary-grey-light: #8a9490;
  
  /* Success Green - Apenas para Conclus√µes */
  --navi-success-green: #28A745;
  --navi-success-green-rgb: 40, 167, 69;
  --navi-success-green-light: rgba(40, 167, 69, 0.1);
  
  /* ===== CORES DE SUPORTE ===== */
  
  --navi-background: #f8fafc;
  --navi-white: #ffffff;
  --navi-border: #e2e8f0;
  --navi-border-dark: #cbd5e0;
  
  /* Cores de Alerta (opcional) */
  --navi-warning: #ffc107;
  --navi-danger: #dc3545;
  --navi-info: #17A2B8; /* Mesma do accent */
  
  /* ===== SOMBRAS ===== */
  
  --navi-shadow-sm: 0 1px 3px rgba(52, 58, 64, 0.08);
  --navi-shadow-md: 0 4px 12px rgba(52, 58, 64, 0.12);
  --navi-shadow-lg: 0 10px 24px rgba(52, 58, 64, 0.15);
  
  /* ===== RAIOS DE BORDA ===== */
  
  --navi-radius-sm: 6px;
  --navi-radius-md: 8px;
  --navi-radius-lg: 12px;
  --navi-radius-full: 9999px;
  
  /* ===== ESPA√áAMENTO (Generoso) ===== */
  
  --navi-spacing-xs: 8px;
  --navi-spacing-sm: 12px;
  --navi-spacing-md: 16px;
  --navi-spacing-lg: 24px;
  --navi-spacing-xl: 32px;
  --navi-spacing-2xl: 48px;
  
  /* ===== TRANSI√á√ïES ===== */
  
  --navi-transition-fast: 0.15s ease;
  --navi-transition-base: 0.2s ease;
  --navi-transition-slow: 0.3s ease;
}

/* ===== TIPOGRAFIA ===== */

/* T√≠tulos - Montserrat */
h1, h2, h3, h4, h5, h6 {
  font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-weight: 600;
  color: var(--navi-primary-dark);
  line-height: 1.3;
  margin: 0;
}

h1 {
  font-size: 32px;
  font-weight: 700;
  line-height: 1.2;
}

h2 {
  font-size: 24px;
  font-weight: 600;
  line-height: 1.3;
}

h3 {
  font-size: 20px;
  font-weight: 600;
  line-height: 1.4;
}

h4 {
  font-size: 18px;
  font-weight: 600;
}

h5 {
  font-size: 16px;
  font-weight: 600;
}

h6 {
  font-size: 14px;
  font-weight: 600;
}

/* Corpo de Texto e UI - Roboto */
body, p, span, div, button, input, select, textarea, label, a {
  font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-weight: 400;
  color: var(--navi-primary-dark);
}

/* UI Elements com √änfase */
.btn, .nav-link, label, .form-label, strong, b {
  font-weight: 500; /* Medium */
}

/* Textos Secund√°rios */
.text-secondary, .subtitle, .description, small {
  color: var(--navi-secondary-grey);
  font-weight: 400;
}

/* ===== BOT√ïES ===== */

.btn {
  padding: var(--navi-spacing-sm) var(--navi-spacing-lg);
  border-radius: var(--navi-radius-md);
  font-family: 'Roboto', sans-serif;
  font-weight: 500;
  font-size: 16px;
  cursor: pointer;
  border: none;
  transition: all var(--navi-transition-base);
  display: inline-flex;
  align-items: center;
  gap: var(--navi-spacing-xs);
  text-decoration: none;
}

/* Bot√£o Prim√°rio - Accent Teal */
.btn-primary {
  background: var(--navi-accent-teal);
  color: var(--navi-white);
  box-shadow: 0 2px 4px rgba(23, 162, 184, 0.15);
}

.btn-primary:hover {
  background: var(--navi-accent-teal-hover);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(23, 162, 184, 0.25);
}

.btn-primary:active {
  transform: translateY(0);
}

/* Bot√£o Secund√°rio */
.btn-secondary {
  background: var(--navi-white);
  color: var(--navi-secondary-grey);
  border: 1px solid var(--navi-border);
}

.btn-secondary:hover {
  border-color: var(--navi-accent-teal);
  color: var(--navi-accent-teal);
  background: var(--navi-accent-teal-light);
}

/* Bot√£o de Sucesso */
.btn-success {
  background: var(--navi-success-green);
  color: var(--navi-white);
  box-shadow: 0 2px 4px rgba(40, 167, 69, 0.15);
}

.btn-success:hover {
  background: #218838;
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(40, 167, 69, 0.25);
}

/* ===== CARDS ===== */

.card {
  background: var(--navi-white);
  border: 1px solid var(--navi-border);
  border-radius: var(--navi-radius-lg);
  padding: var(--navi-spacing-lg);
  margin-bottom: var(--navi-spacing-lg);
  box-shadow: var(--navi-shadow-sm);
  transition: all var(--navi-transition-base);
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: var(--navi-shadow-md);
}

.card-title {
  font-family: 'Montserrat', sans-serif;
  font-weight: 600;
  font-size: 20px;
  color: var(--navi-primary-dark);
  margin-bottom: var(--navi-spacing-md);
}

.card-subtitle {
  font-family: 'Roboto', sans-serif;
  font-weight: 400;
  font-size: 14px;
  color: var(--navi-secondary-grey);
  margin-bottom: var(--navi-spacing-sm);
}

/* ===== NAVEGA√á√ÉO ===== */

.nav-link {
  display: flex;
  align-items: center;
  gap: var(--navi-spacing-sm);
  padding: var(--navi-spacing-sm) var(--navi-spacing-lg);
  color: var(--navi-secondary-grey);
  font-family: 'Roboto', sans-serif;
  font-weight: 400;
  font-size: 16px;
  text-decoration: none;
  border-left: 3px solid transparent;
  transition: all var(--navi-transition-base);
}

.nav-link:hover {
  background: var(--navi-accent-teal-light);
  color: var(--navi-accent-teal);
}

.nav-link.active {
  background: var(--navi-accent-teal-light);
  color: var(--navi-accent-teal);
  border-left-color: var(--navi-accent-teal);
  font-weight: 500;
}

/* ===== BADGES ===== */

.badge {
  display: inline-flex;
  align-items: center;
  padding: 4px 12px;
  border-radius: var(--navi-radius-full);
  font-size: 12px;
  font-weight: 500;
  line-height: 1;
}

.badge-primary {
  background: var(--navi-accent-teal-light);
  color: var(--navi-accent-teal);
}

.badge-success {
  background: var(--navi-success-green-light);
  color: var(--navi-success-green);
}

.badge-secondary {
  background: #f1f5f9;
  color: var(--navi-secondary-grey);
}

/* ===== INDICADORES DE PROGRESSO ===== */

.progress-bar {
  width: 100%;
  height: 8px;
  background: var(--navi-border);
  border-radius: var(--navi-radius-sm);
  overflow: hidden;
}

.progress-bar-fill {
  height: 100%;
  background: var(--navi-accent-teal);
  transition: width var(--navi-transition-slow);
  border-radius: var(--navi-radius-sm);
}

/* ===== UTILIT√ÅRIOS ===== */

/* Cores de Texto */
.text-primary { color: var(--navi-primary-dark); }
.text-accent { color: var(--navi-accent-teal); }
.text-secondary { color: var(--navi-secondary-grey); }
.text-success { color: var(--navi-success-green); }
.text-white { color: var(--navi-white); }

/* Cores de Background */
.bg-primary { background-color: var(--navi-primary-dark); }
.bg-accent { background-color: var(--navi-accent-teal); }
.bg-secondary { background-color: var(--navi-secondary-grey); }
.bg-success { background-color: var(--navi-success-green); }
.bg-light { background-color: var(--navi-background); }
.bg-white { background-color: var(--navi-white); }

/* Espa√ßamentos */
.p-sm { padding: var(--navi-spacing-sm); }
.p-md { padding: var(--navi-spacing-md); }
.p-lg { padding: var(--navi-spacing-lg); }
.p-xl { padding: var(--navi-spacing-xl); }

.m-sm { margin: var(--navi-spacing-sm); }
.m-md { margin: var(--navi-spacing-md); }
.m-lg { margin: var(--navi-spacing-lg); }
.m-xl { margin: var(--navi-spacing-xl); }

/* Sombras */
.shadow-sm { box-shadow: var(--navi-shadow-sm); }
.shadow-md { box-shadow: var(--navi-shadow-md); }
.shadow-lg { box-shadow: var(--navi-shadow-lg); }

/* Arredondamento */
.rounded-sm { border-radius: var(--navi-radius-sm); }
.rounded-md { border-radius: var(--navi-radius-md); }
.rounded-lg { border-radius: var(--navi-radius-lg); }
.rounded-full { border-radius: var(--navi-radius-full); }

/* ===== TABELAS ===== */

.navi-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: var(--navi-spacing-md);
}

.navi-table th,
.navi-table td {
  text-align: left;
  padding: 12px;
  border-bottom: 1px solid #e2e8f0;
}

.navi-table th {
  background: #f8fafc;
  font-weight: 600;
  color: #374151;
}

.navi-table tbody tr:hover {
  background: #f8fafc;
}

/* ===== ANIMA√á√ïES ===== */

* {
  transition-timing-function: ease;
}

.interactive {
  transition: transform var(--navi-transition-base);
}

.interactive:hover {
  transform: translateY(-1px);
}

.card-hover {
  transition: all var(--navi-transition-base);
}

.card-hover:hover {
  transform: translateY(-2px);
  box-shadow: var(--navi-shadow-md);
}

@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

.fade-in {
  animation: fade-in 0.2s ease-in;
}

@keyframes slide-in-top {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.slide-in-top {
  animation: slide-in-top 0.3s ease-out;
}

@keyframes success-flash {
  0% {
    background: var(--navi-success-green-light);
    border-color: var(--navi-success-green);
  }
  50% {
    background: var(--navi-success-green);
    color: var(--navi-white);
  }
  100% {
    background: var(--navi-white);
    border-color: var(--navi-border);
    color: var(--navi-secondary-grey);
  }
}

.task-completed {
  animation: success-flash 2s ease-in-out;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.spinner {
  animation: spin 1s linear infinite;
}

*:focus {
  outline: 2px solid var(--navi-accent-teal);
  outline-offset: 2px;
}

button:focus, 
input:focus, 
select:focus, 
textarea:focus {
  outline: 2px solid var(--navi-accent-teal);
  outline-offset: 2px;
}

button:not(:disabled):hover,
a:hover {
  transition: all var(--navi-transition-base);
}
    </style>
    
    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--navi-background);
            color: var(--navi-primary-dark);
        }
        
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: var(--navi-white);
            border-right: 1px solid var(--navi-border);
            padding: var(--navi-spacing-xl) 0;
            z-index: 100;
            transition: width var(--navi-transition-slow);
        }
        
        .sidebar.collapsed {
            width: 80px;
        }
        
        .sidebar-toggle {
            position: absolute;
            top: var(--navi-spacing-md);
            right: var(--navi-spacing-md);
            background: var(--navi-background);
            border: none;
            border-radius: var(--navi-radius-sm);
            padding: var(--navi-spacing-sm);
            cursor: pointer;
            transition: all var(--navi-transition-base);
        }
        
        .sidebar-toggle:hover {
            background: var(--navi-border);
        }
        
        .sidebar-header {
            padding: 0 var(--navi-spacing-xl);
            margin-bottom: var(--navi-spacing-xl);
            transition: padding var(--navi-transition-slow);
        }
        
        .sidebar.collapsed .sidebar-header {
            padding: 0 1rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Montserrat', sans-serif;
            color: var(--navi-primary-dark);
            transition: all 0.3s ease;
        }
        
        .sidebar.collapsed .logo {
            font-size: 1rem;
            justify-content: center;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            flex-shrink: 0;
        }
        
        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .sidebar.collapsed .logo-icon {
            width: 32px;
            height: 32px;
            font-size: 1rem;
        }
        
        .nav-text {
            transition: all 0.3s ease;
        }
        
        .sidebar.collapsed .nav-text {
            display: none;
        }
        
        .tenant-info {
            margin-top: var(--navi-spacing-md);
            padding: var(--navi-spacing-md);
            background: var(--navi-background);
            border-radius: var(--navi-radius-md);
            border-left: 4px solid var(--navi-accent-teal);
            transition: all var(--navi-transition-slow);
        }
        
        .sidebar.collapsed .tenant-info {
            padding: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .tenant-info h3 {
            font-size: 0.9rem;
            color: var(--navi-secondary-grey);
            margin-bottom: 0.25rem;
            transition: all var(--navi-transition-slow);
        }
        
        .sidebar.collapsed .tenant-info h3 {
            font-size: 0.7rem;
            text-align: center;
        }
        
        .tenant-info p {
            font-size: 0.8rem;
            color: var(--navi-secondary-grey);
            transition: all var(--navi-transition-slow);
        }
        
        .sidebar.collapsed .tenant-info p {
            display: none;
        }
        
        .nav-menu {
            list-style: none;
            transition: all 0.3s ease;
        }
        
        .nav-item {
            margin-bottom: 0.5rem;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: var(--navi-spacing-sm);
            padding: var(--navi-spacing-sm) var(--navi-spacing-xl);
            color: var(--navi-secondary-grey);
            text-decoration: none;
            transition: all var(--navi-transition-base);
            border-left: 3px solid transparent;
            position: relative;
        }
        
        .sidebar.collapsed .nav-link {
            padding: 0.75rem 1rem;
            justify-content: center;
        }
        
        .nav-link:hover {
            background: var(--navi-accent-teal-light);
            color: var(--navi-accent-teal);
        }
        
        .nav-link.active {
            background: var(--navi-accent-teal-light);
            color: var(--navi-accent-teal);
            border-left-color: var(--navi-accent-teal);
        }
        
        .nav-icon {
            font-size: 1.2rem;
            width: 20px;
            text-align: center;
            flex-shrink: 0;
        }
        
        .main-content {
            margin-left: 280px;
            min-height: 100vh;
            transition: margin-left var(--navi-transition-slow);
        }
        
        .sidebar.collapsed + .main-content {
            margin-left: 80px;
        }
        
        .top-bar {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .content {
            padding: 2rem;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .section-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        .btn-primary {
            background: var(--navi-accent-teal);
            color: var(--navi-white);
            border: none;
            padding: var(--navi-spacing-sm) var(--navi-spacing-lg);
            border-radius: var(--navi-radius-md);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--navi-transition-base);
        }
        
        .btn-primary:hover {
            background: var(--navi-accent-teal-hover);
        }
        
        .btn-secondary {
            background: var(--navi-accent-teal);
            color: var(--navi-white);
            border: none;
            padding: var(--navi-spacing-sm) var(--navi-spacing-md);
            border-radius: 8px !important;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Roboto', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: var(--navi-spacing-xs);
        }
        
        .btn-secondary:hover {
            background: var(--navi-accent-teal-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(23, 162, 184, 0.3);
        }
        
        /* For√ßar border-radius em todos os bot√µes */
        button {
            border-radius: 8px !important;
        }
        
        .btn-primary {
            border-radius: 8px !important;
        }
        
        .btn-secondary {
            border-radius: 8px !important;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--navi-accent-teal);
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: var(--navi-secondary-grey);
            font-size: 0.9rem;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Tooltip para menu recolhido */
        .sidebar.collapsed .nav-link::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            background: #1e293b;
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
            z-index: 1000;
            margin-left: 0.5rem;
        }
        
        .sidebar.collapsed .nav-link:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        /* Registration Routine Styles */
        .routine-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .routine-item:hover {
            border-color: #2563eb;
            box-shadow: 0 2px 4px rgba(37, 99, 235, 0.1);
        }
        
        .routine-icon {
            font-size: 2rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            border-radius: 8px;
            flex-shrink: 0;
        }
        
        .routine-text h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.25rem;
        }
        
        .routine-text p {
            font-size: 0.9rem;
            color: #64748b;
            margin: 0;
        }
        
        /* Inline editing styles */
        .inline-row {
            background: #f8fafc !important;
            border: 2px solid #e2e8f0 !important;
        }
        
        .inline-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .btn-inline-save {
            background: #10b981;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .btn-inline-cancel {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .btn-inline-save:hover {
            background: #059669;
        }
        
        .btn-inline-cancel:hover {
            background: #dc2626;
        }
        
        .btn-edit {
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            font-size: 0.8rem;
            margin-right: 0.5rem;
        }
        
        .btn-edit:hover {
            background: #2563eb;
        }
        
        .btn-delete {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .btn-delete:hover {
            background: #dc2626;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <button class="sidebar-toggle" onclick="toggleSidebar()">
            <span id="toggle-icon">‚Üê</span>
        </button>
        
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">
                    <svg width="48" height="32" viewBox="0 0 48 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <!-- Grupo do logo compacto -->
                      <g transform="translate(24, 20)">
                        <!-- Texto "NAV" -->
                        <text
                          font-family="Montserrat, Arial, sans-serif"
                          font-weight="700"
                          font-size="16"
                          fill="#343A40"
                          text-anchor="middle"
                          y="3">NAV</text>

                        <!-- Letra "I" -->
                        <text
                          font-family="Montserrat, Arial, sans-serif"
                          font-weight="700"
                          font-size="16"
                          fill="#343A40"
                          x="20"
                          y="3">I</text>

                        <!-- Caret com accent teal -->
                        <path
                          d="M20 -4 L21.5 -7 L23 -4"
                          stroke="#17A2B8"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          fill="none"/>
                      </g>
                </svg>
                </div>
                <span class="nav-text">Navigator</span>
            </div>
            <div class="tenant-info">
                <h3 id="tenantName">Carregando...</h3>
                <p id="tenantSubdomain">Carregando...</p>
            </div>
        </div>
        
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="dashboard.html" class="nav-link active" data-tooltip="Insights do Nav√Æ">
                    <i data-feather="bar-chart-2" class="nav-icon"></i>
                    <span class="nav-text">Insights</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="funcionarios.html" class="nav-link" data-tooltip="Colaboradores">
                    <i data-feather="users" class="nav-icon"></i>
                    <span class="nav-text">Colaboradores</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="admin-trilhas.html" class="nav-link" data-tooltip="Trilhas">
                    <i data-feather="layers" class="nav-icon"></i>
                    <span class="nav-text">Trilhas</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="documentos.html" class="nav-link" data-tooltip="Documentos">
                    <i data-feather="file-text" class="nav-icon"></i>
                    <span class="nav-text">Documentos</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="configurador.html" class="nav-link" data-tooltip="Configura√ß√µes">
                    <i data-feather="settings" class="nav-icon"></i>
                    <span class="nav-text">Configura√ß√µes</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Bar -->
        <header class="top-bar">
            <h1 id="pageTitle">Insights do Nav√Æ</h1>
            <div>
                <span id="currentTime"></span>
            </div>
        </header>

        <!-- Content -->
        <div class="content">
            <!-- Insights Section -->
            <div id="insights-section" class="section active">
                <div class="section-header">
                    <h2>üí° Insights do Agente de IA</h2>
                    <div style="display: flex; gap: 0.5rem;">
                        <select id="insights-period" onchange="loadInsightsData()" style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                            <option value="7">√öltimos 7 dias</option>
                            <option value="30" selected>√öltimos 30 dias</option>
                            <option value="90">√öltimos 90 dias</option>
                        </select>
                        <button class="btn-secondary" onclick="loadInsightsData()">
                            <i data-feather="refresh-cw"></i>
                            Atualizar
                        </button>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalAnotacoes">0</div>
                        <div class="stat-label">üìù Anota√ß√µes Capturadas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalPadroes">0</div>
                        <div class="stat-label">üîç Padr√µes Identificados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalMelhorias">0</div>
                        <div class="stat-label">üí° Melhorias Sugeridas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="sentimentoMedio">--</div>
                        <div class="stat-label">üòä Sentimento M√©dio</div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                    <div class="card">
                        <h3 style="margin-bottom: 1rem;">üìä Distribui√ß√£o por Tipo</h3>
                        <div id="chartTipos" style="min-height: 200px;">
                            <p style="text-align: center; color: #94a3b8; padding: 2rem;">Carregando...</p>
                        </div>
                    </div>
                    <div class="card">
                        <h3 style="margin-bottom: 1rem;">üòä Distribui√ß√£o por Sentimento</h3>
                        <div id="chartSentimentos" style="min-height: 200px;">
                            <p style="text-align: center; color: #94a3b8; padding: 2rem;">Carregando...</p>
                        </div>
                    </div>
                </div>

                <!-- Padr√µes Identificados -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <h3 style="margin-bottom: 1rem;">üîç Padr√µes Identificados</h3>
                    <div id="padroesContainer">
                        <p style="text-align: center; color: #94a3b8; padding: 2rem;">Carregando padr√µes...</p>
                    </div>
                </div>

                <!-- Anota√ß√µes Recentes -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>üìù Anota√ß√µes Recentes</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <select id="filtroTipo" onchange="filtrarAnotacoes()" style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                                <option value="">Todos os tipos</option>
                                <option value="duvida_frequente">D√∫vida Frequente</option>
                                <option value="dificuldade_trilha">Dificuldade na Trilha</option>
                                <option value="feedback_positivo">Feedback Positivo</option>
                                <option value="feedback_negativo">Feedback Negativo</option>
                                <option value="sugestao_melhoria">Sugest√£o de Melhoria</option>
                                <option value="observacao_geral">Observa√ß√£o Geral</option>
                            </select>
                            <select id="filtroSentimento" onchange="filtrarAnotacoes()" style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                                <option value="">Todos sentimentos</option>
                                <option value="muito_positivo">Muito Positivo</option>
                                <option value="positivo">Positivo</option>
                                <option value="neutro">Neutro</option>
                                <option value="negativo">Negativo</option>
                                <option value="muito_negativo">Muito Negativo</option>
                            </select>
                        </div>
                    </div>
                    <div id="anotacoesContainer">
                        <p style="text-align: center; color: #94a3b8; padding: 2rem;">Carregando anota√ß√µes...</p>
                    </div>
                </div>
            </div>

            <!-- Users Section -->
            <div id="users-section" class="section hidden">
                <div class="section-header">
                    <h2>Colaboradores</h2>
                    <button class="btn-primary">+ Novo Colaborador</button>
                </div>
                <div class="card">
                    <p>Funcionalidade de colaboradores em desenvolvimento...</p>
                </div>
            </div>

            <!-- Documents Section -->
            <div id="documents-section" class="section hidden">
                <div class="section-header">
                    <h2>Documentos</h2>
                    <button class="btn-primary">+ Novo Documento</button>
                </div>
                <div class="card">
                    <p>Funcionalidade de documentos em desenvolvimento...</p>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings-section" class="section hidden">
                <div class="section-header">
                    <h2>Configura√ß√µes</h2>
                </div>
                
                <!-- Main Settings View -->
                <div id="settings-main">
                    <div class="card">
                        <h3>Informa√ß√µes da Empresa</h3>
                        <div style="margin-bottom: 1rem;">
                            <label><strong>Nome da Empresa:</strong></label>
                            <p id="companyName">Empresa Demo</p>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label><strong>Subdom√≠nio:</strong></label>
                            <p id="companySubdomain">demo.flowly.com</p>
                        </div>
                        <div style="background: #dcfce7; padding: 1rem; border-radius: 6px; border-left: 4px solid #16a34a;">
                            <strong>‚úÖ Integra√ß√£o WhatsApp Ativa</strong>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Cadastros (4)</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
                            <div class="routine-item" onclick="showRegistrationRoutine('departments')">
                                <div class="routine-icon">üè¢</div>
                                <div class="routine-text">
                                    <h4>Departamentos</h4>
                                    <p>Gerencie os departamentos da empresa</p>
                                </div>
                            </div>
                            
                            <div class="routine-item" onclick="showRegistrationRoutine('categories')">
                                <div class="routine-icon">üìÇ</div>
                                <div class="routine-text">
                                    <h4>Categorias de Documentos</h4>
                                    <p>Organize os tipos de documentos</p>
                                </div>
                            </div>
                            
                            <div class="routine-item" onclick="showRegistrationRoutine('positions')">
                                <div class="routine-icon">üëî</div>
                                <div class="routine-text">
                                    <h4>Cargos</h4>
                                    <p>Defina os cargos da empresa</p>
                                </div>
                            </div>
                            
                            <div class="routine-item" onclick="showRegistrationRoutine('tags')">
                                <div class="routine-icon">üè∑Ô∏è</div>
                                <div class="routine-text">
                                    <h4>Tags Personalizadas</h4>
                                    <p>Crie tags para classifica√ß√£o</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Registration Routine View -->
                <div id="settings-registration" class="hidden">
                    <div class="section-header">
                        <button class="btn-secondary" onclick="backToSettings()">‚Üê Voltar</button>
                        <h2 id="routine-title">Cadastro</h2>
                    </div>
                    
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <button class="btn-primary" onclick="addNewItemInline()">
                                + Novo <span id="new-item-text">Item</span>
                            </button>
                            <input type="text" id="routineSearch" placeholder="Pesquisar por nome..." onkeyup="searchRoutineItems()" style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; width: 250px;">
                        </div>
                        
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;">
                                        <th style="padding: 1rem; text-align: left; font-weight: 600;">Nome</th>
                                        <th style="padding: 1rem; text-align: left; font-weight: 600;">Data Cria√ß√£o</th>
                                        <th style="padding: 1rem; text-align: center; font-weight: 600;">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="routine-grid-body">
                                    <tr>
                                        <td colspan="3" style="padding: 2rem; text-align: center; color: #6b7280; font-style: italic;">
                                            Carregando dados...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e2e8f0;">
                            <div id="grid-info" style="color: #6b7280; font-size: 0.9rem;">0 resultados</div>
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                <button class="btn-secondary" onclick="loadMoreItems()">Carregar mais 10 resultados</button>
                                <div style="display: flex; gap: 0.5rem; align-items: center; color: #6b7280; font-size: 0.9rem;">
                                    EXIBIR
                                    <select id="itemsPerPage" onchange="changeItemsPerPage()" style="padding: 0.25rem; border: 1px solid #d1d5db; border-radius: 4px;">
                                        <option value="10">10</option>
                                        <option value="25">25</option>
                                        <option value="50">50</option>
                                    </select>
                                    RESULTADOS POR VEZ
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const API_BASE = window.location.origin;
        let currentTenant = null;
        let currentUser = null;
        
        // Sidebar toggle functionality
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleIcon = document.getElementById('toggle-icon');
            
            sidebar.classList.toggle('collapsed');
            
            // Update toggle icon
            if (sidebar.classList.contains('collapsed')) {
                toggleIcon.textContent = '‚Üí';
            } else {
                toggleIcon.textContent = '‚Üê';
            }
            
            // Save preference to localStorage
            localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
        }
        
        // Load sidebar state on page load
        function loadSidebarState() {
            const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            const sidebar = document.getElementById('sidebar');
            const toggleIcon = document.getElementById('toggle-icon');
            
            if (isCollapsed) {
                sidebar.classList.add('collapsed');
                toggleIcon.textContent = '‚Üí';
            }
        }
        
        // Get tenant from URL
        function getTenantFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('tenant') || 'demo';
        }
        
        // Load tenant info
        async function loadTenantInfo() {
            try {
                const tenantSubdomain = getTenantFromUrl();
                console.log('üîç Buscando tenant:', tenantSubdomain);
                
                const response = await fetch(`${API_BASE}/api/tenants/${tenantSubdomain}`);
                console.log('üì° Resposta da API:', response.status, response.statusText);
                
                if (response.ok) {
                    currentTenant = await response.json();
                    console.log('‚úÖ Tenant carregado:', currentTenant);
                    document.getElementById('tenantName').textContent = currentTenant.name;
                    document.getElementById('tenantSubdomain').textContent = `${currentTenant.subdomain}.flowly.com`;
                } else {
                    console.warn('‚ö†Ô∏è Tenant n√£o encontrado, usando fallback');
                    // Fallback para demo
                    currentTenant = {
                        id: 'demo-id',
                        name: 'Empresa Demo',
                        subdomain: 'demo'
                    };
                    document.getElementById('tenantName').textContent = 'Empresa Demo';
                    document.getElementById('tenantSubdomain').textContent = 'demo.flowly.com';
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar tenant:', error);
                // Fallback para demo
                currentTenant = {
                    id: 'demo-id',
                    name: 'Empresa Demo',
                    subdomain: 'demo'
                };
                document.getElementById('tenantName').textContent = 'Empresa Demo';
                document.getElementById('tenantSubdomain').textContent = 'demo.flowly.com';
            }
        }
        
        // Show section - fun√ß√£o global para navega√ß√£o entre se√ß√µes
        window.showSection = function(section) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(el => {
                el.classList.add('hidden');
                el.classList.remove('active');
            });
            
            // Update tab buttons (if they exist)
            const tabButtons = document.querySelectorAll('.tab-button');
            if (tabButtons.length > 0) {
                tabButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                const targetTab = document.getElementById(`${section}-tab`);
                if (targetTab) {
                    targetTab.classList.add('active');
                }
            }
            
            // Show selected section
            const targetSection = document.getElementById(`${section}-section`);
            if (targetSection) {
                targetSection.classList.remove('hidden');
                targetSection.classList.add('active');
            }
            
            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'insights': 'Insights do Nav√Æ',
                'users': 'Colaboradores',
                'documents': 'Documentos',
                'settings': 'Configura√ß√µes'
            };
            const pageTitle = document.getElementById('pageTitle');
            if (pageTitle) {
                pageTitle.textContent = titles[section] || 'Dashboard';
            }
            
            // Load data for insights section
            if (section === 'insights') {
                loadInsightsData();
            }
        }
        
        // Update time
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('pt-BR');
        }
        
        // ===== INSIGHTS FUNCTIONS =====
        let allAnotacoes = [];
        let tenantId = '5978f911-738b-4aae-802a-f037fdac2e64'; // Default tenant
        
        async function loadInsightsData() {
            try {
                const days = document.getElementById('insights-period').value;
                console.log('üìä Carregando insights dos √∫ltimos', days, 'dias...');
                
                // Load statistics
                await Promise.all([
                    loadInsightsStats(days),
                    loadPadroes(days),
                    loadAnotacoes(days)
                ]);
                
                console.log('‚úÖ Insights carregados com sucesso!');
                
                // Atualizar Feather Icons ap√≥s carregar dados
                if (typeof feather !== 'undefined') {
                    feather.replace();
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar insights:', error);
            }
        }
        
        async function loadInsightsStats(days) {
            try {
                // Load anota√ß√µes
                const anotacoesRes = await fetch(`${API_BASE}/api/agente/anotacoes/${tenantId}?days=${days}`);
                const anotacoesData = await anotacoesRes.json();
                const anotacoes = anotacoesData.anotacoes || anotacoesData;
                
                // Load padr√µes
                const padroesRes = await fetch(`${API_BASE}/api/agente/anotacoes/padroes/${tenantId}?days=${days}`);
                const padroes = await padroesRes.json();
                
                // Count melhorias (anota√ß√µes que geraram melhorias)
                const melhorias = anotacoes.filter(a => a.gerou_melhoria).length;
                
                // Calculate average sentiment
                const sentimentos = {
                    muito_positivo: 5,
                    positivo: 4,
                    neutro: 3,
                    negativo: 2,
                    muito_negativo: 1
                };
                
                let totalSentimento = 0;
                let countSentimento = 0;
                anotacoes.forEach(a => {
                    if (a.sentimento && sentimentos[a.sentimento]) {
                        totalSentimento += sentimentos[a.sentimento];
                        countSentimento++;
                    }
                });
                
                const mediaSentimento = countSentimento > 0 ? (totalSentimento / countSentimento).toFixed(1) : '--';
                const emojiSentimento = mediaSentimento >= 4 ? 'üòä' : mediaSentimento >= 3 ? 'üòê' : 'üòî';
                
                // Update stats
                document.getElementById('totalAnotacoes').textContent = anotacoes.length;
                document.getElementById('totalPadroes').textContent = padroes.padroes_por_tipo?.length || 0;
                document.getElementById('totalMelhorias').textContent = melhorias;
                document.getElementById('sentimentoMedio').textContent = mediaSentimento !== '--' ? `${emojiSentimento} ${mediaSentimento}/5` : '--';
                
                // Render charts
                renderChartTipos(padroes.padroes_por_tipo || []);
                renderChartSentimentos(anotacoes);
                
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas:', error);
                document.getElementById('totalAnotacoes').textContent = '0';
                document.getElementById('totalPadroes').textContent = '0';
                document.getElementById('totalMelhorias').textContent = '0';
                document.getElementById('sentimentoMedio').textContent = '--';
            }
        }
        
        async function loadPadroes(days) {
            try {
                const response = await fetch(`${API_BASE}/api/agente/anotacoes/padroes/${tenantId}?days=${days}`);
                const data = await response.json();
                
                const container = document.getElementById('padroesContainer');
                
                if (!data || (!data.padroes_por_tipo && !data.tags_frequentes && !data.trilhas_problematicas)) {
                    container.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 2rem;">Nenhum padr√£o identificado ainda</p>';
                    return;
                }
                
                let html = '';
                
                // Padr√µes por tipo
                if (data.padroes_por_tipo && data.padroes_por_tipo.length > 0) {
                    html += '<div style="margin-bottom: 1.5rem;"><h4 style="margin-bottom: 0.5rem;">üìã Por Tipo</h4>';
                    data.padroes_por_tipo.forEach(p => {
                        const tipoLabel = formatTipo(p.tipo);
                        html += `
                            <div style="padding: 0.75rem; background: #f8fafc; border-left: 3px solid #2563eb; margin-bottom: 0.5rem; border-radius: 4px;">
                                <strong>${tipoLabel}</strong>: ${p.total} ocorr√™ncias
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                // Tags mais frequentes
                if (data.tags_frequentes && data.tags_frequentes.length > 0) {
                    html += '<div style="margin-bottom: 1.5rem;"><h4 style="margin-bottom: 0.5rem;">üè∑Ô∏è Tags Mais Frequentes</h4><div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">';
                    data.tags_frequentes.forEach(tag => {
                        html += `<span style="padding: 0.25rem 0.75rem; background: #dbeafe; color: #1e40af; border-radius: 20px; font-size: 0.9rem;">${tag.tag} (${tag.count})</span>`;
                    });
                    html += '</div></div>';
                }
                
                // Trilhas problem√°ticas
                if (data.trilhas_problematicas && data.trilhas_problematicas.length > 0) {
                    html += '<div><h4 style="margin-bottom: 0.5rem;">‚ö†Ô∏è Trilhas com Mais Feedbacks Negativos</h4>';
                    data.trilhas_problematicas.forEach(t => {
                        html += `
                            <div style="padding: 0.75rem; background: #fef2f2; border-left: 3px solid #ef4444; margin-bottom: 0.5rem; border-radius: 4px;">
                                <strong>Trilha ID ${t.trilha_id || 'N/A'}</strong>: ${t.total} feedbacks negativos
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                container.innerHTML = html || '<p style="text-align: center; color: #94a3b8; padding: 2rem;">Nenhum padr√£o identificado</p>';
                
            } catch (error) {
                console.error('Erro ao carregar padr√µes:', error);
                document.getElementById('padroesContainer').innerHTML = '<p style="text-align: center; color: #ef4444; padding: 2rem;">Erro ao carregar padr√µes</p>';
            }
        }
        
        async function loadAnotacoes(days) {
            try {
                const response = await fetch(`${API_BASE}/api/agente/anotacoes/${tenantId}?days=${days}`);
                const data = await response.json();
                allAnotacoes = data.anotacoes || data;
                
                renderAnotacoes(allAnotacoes);
                
            } catch (error) {
                console.error('Erro ao carregar anota√ß√µes:', error);
                document.getElementById('anotacoesContainer').innerHTML = '<p style="text-align: center; color: #ef4444; padding: 2rem;">Erro ao carregar anota√ß√µes</p>';
            }
        }
        
        function renderAnotacoes(anotacoes) {
            const container = document.getElementById('anotacoesContainer');
            
            if (anotacoes.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 2rem;">Nenhuma anota√ß√£o encontrada</p>';
                return;
            }
            
            let html = '<div style="display: flex; flex-direction: column; gap: 1rem;">';
            
            // Show last 20 annotations
            const displayAnotacoes = anotacoes.slice(0, 20);
            
            displayAnotacoes.forEach(a => {
                const tipoLabel = formatTipo(a.tipo);
                const sentimentoEmoji = getSentimentoEmoji(a.sentimento);
                const sentimentoBg = getSentimentoBg(a.sentimento);
                const date = new Date(a.created_at).toLocaleString('pt-BR');
                
                html += `
                    <div style="padding: 1rem; background: white; border: 1px solid #e2e8f0; border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                            <div>
                                <span style="padding: 0.25rem 0.5rem; background: #dbeafe; color: #1e40af; border-radius: 4px; font-size: 0.85rem; font-weight: 500;">${tipoLabel}</span>
                                ${a.gerou_melhoria ? '<span style="margin-left: 0.5rem; padding: 0.25rem 0.5rem; background: #dcfce7; color: #166534; border-radius: 4px; font-size: 0.85rem;">üí° Gerou Melhoria</span>' : ''}
                            </div>
                            <span style="padding: 0.25rem 0.5rem; background: ${sentimentoBg}; border-radius: 4px; font-size: 0.85rem;">${sentimentoEmoji} ${formatSentimento(a.sentimento)}</span>
                        </div>
                        <h4 style="margin: 0.5rem 0; color: #1e293b;">${a.titulo || 'Sem t√≠tulo'}</h4>
                        <p style="margin: 0.5rem 0; color: #64748b; font-size: 0.95rem;">${a.anotacao}</p>
                        ${a.tags && a.tags.length > 0 ? `
                            <div style="display: flex; flex-wrap: wrap; gap: 0.25rem; margin: 0.5rem 0;">
                                ${a.tags.map(tag => `<span style="padding: 0.15rem 0.5rem; background: #f1f5f9; color: #475569; border-radius: 12px; font-size: 0.8rem;">#${tag}</span>`).join('')}
                            </div>
                        ` : ''}
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #f1f5f9; font-size: 0.85rem; color: #94a3b8;">
                            <span>üë§ ${a.colaborador_nome || 'N/A'}</span>
                            <span>üïí ${date}</span>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            if (anotacoes.length > 20) {
                html += `<p style="text-align: center; color: #64748b; margin-top: 1rem;">Mostrando 20 de ${anotacoes.length} anota√ß√µes</p>`;
            }
            
            container.innerHTML = html;
        }
        
        function filtrarAnotacoes() {
            const tipo = document.getElementById('filtroTipo').value;
            const sentimento = document.getElementById('filtroSentimento').value;
            
            let filtered = allAnotacoes;
            
            if (tipo) {
                filtered = filtered.filter(a => a.tipo === tipo);
            }
            
            if (sentimento) {
                filtered = filtered.filter(a => a.sentimento === sentimento);
            }
            
            renderAnotacoes(filtered);
        }
        
        function renderChartTipos(padroesTipo) {
            const container = document.getElementById('chartTipos');
            
            if (!padroesTipo || padroesTipo.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 2rem;">Sem dados</p>';
                return;
            }
            
            const maxValue = Math.max(...padroesTipo.map(p => p.total));
            
            let html = '<div style="display: flex; flex-direction: column; gap: 0.75rem;">';
            
            padroesTipo.forEach(p => {
                const percentage = (p.total / maxValue) * 100;
                const tipoLabel = formatTipo(p.tipo);
                
                html += `
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                            <span style="font-size: 0.9rem; color: #475569;">${tipoLabel}</span>
                            <span style="font-size: 0.9rem; font-weight: 600; color: #1e293b;">${p.total}</span>
                        </div>
                        <div style="width: 100%; height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden;">
                            <div style="width: ${percentage}%; height: 100%; background: linear-gradient(90deg, #2563eb, #1d4ed8); transition: width 0.3s;"></div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function renderChartSentimentos(anotacoes) {
            const container = document.getElementById('chartSentimentos');
            
            if (!anotacoes || anotacoes.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 2rem;">Sem dados</p>';
                return;
            }
            
            // Count sentimentos
            const counts = {
                muito_positivo: 0,
                positivo: 0,
                neutro: 0,
                negativo: 0,
                muito_negativo: 0
            };
            
            anotacoes.forEach(a => {
                if (a.sentimento && counts.hasOwnProperty(a.sentimento)) {
                    counts[a.sentimento]++;
                }
            });
            
            const sentimentos = [
                { label: 'Muito Positivo', value: counts.muito_positivo, emoji: 'üòç', color: '#10b981' },
                { label: 'Positivo', value: counts.positivo, emoji: 'üòä', color: '#3b82f6' },
                { label: 'Neutro', value: counts.neutro, emoji: 'üòê', color: '#6b7280' },
                { label: 'Negativo', value: counts.negativo, emoji: 'üòî', color: '#f59e0b' },
                { label: 'Muito Negativo', value: counts.muito_negativo, emoji: 'üò°', color: '#ef4444' }
            ];
            
            const maxValue = Math.max(...sentimentos.map(s => s.value));
            
            let html = '<div style="display: flex; flex-direction: column; gap: 0.75rem;">';
            
            sentimentos.forEach(s => {
                if (s.value === 0) return; // Skip zero values
                
                const percentage = maxValue > 0 ? (s.value / maxValue) * 100 : 0;
                
                html += `
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                            <span style="font-size: 0.9rem; color: #475569;">${s.emoji} ${s.label}</span>
                            <span style="font-size: 0.9rem; font-weight: 600; color: #1e293b;">${s.value}</span>
                        </div>
                        <div style="width: 100%; height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden;">
                            <div style="width: ${percentage}%; height: 100%; background: ${s.color}; transition: width 0.3s;"></div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function formatTipo(tipo) {
            const tipos = {
                duvida_frequente: '‚ùì D√∫vida Frequente',
                dificuldade_trilha: 'üöß Dificuldade na Trilha',
                feedback_positivo: 'üëç Feedback Positivo',
                feedback_negativo: 'üëé Feedback Negativo',
                sugestao_melhoria: 'üí° Sugest√£o de Melhoria',
                observacao_geral: 'üìù Observa√ß√£o Geral'
            };
            return tipos[tipo] || tipo;
        }
        
        function formatSentimento(sentimento) {
            const sentimentos = {
                muito_positivo: 'Muito Positivo',
                positivo: 'Positivo',
                neutro: 'Neutro',
                negativo: 'Negativo',
                muito_negativo: 'Muito Negativo'
            };
            return sentimentos[sentimento] || sentimento || 'N/A';
        }
        
        function getSentimentoEmoji(sentimento) {
            const emojis = {
                muito_positivo: 'üòç',
                positivo: 'üòä',
                neutro: 'üòê',
                negativo: 'üòî',
                muito_negativo: 'üò°'
            };
            return emojis[sentimento] || 'üòê';
        }
        
        function getSentimentoBg(sentimento) {
            const colors = {
                muito_positivo: '#dcfce7',
                positivo: '#dbeafe',
                neutro: '#f3f4f6',
                negativo: '#fef3c7',
                muito_negativo: '#fee2e2'
            };
            return colors[sentimento] || '#f3f4f6';
        }
        // ===== END INSIGHTS FUNCTIONS =====
        
        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('üöÄ Iniciando carregamento do dashboard...');
                
                console.log('üì± Carregando estado da sidebar...');
                loadSidebarState();
                
                console.log('üè¢ Carregando informa√ß√µes do tenant...');
                await loadTenantInfo();
                
                console.log('‚è∞ Atualizando rel√≥gio...');
                updateTime();
                setInterval(updateTime, 1000);
                
                console.log('‚úÖ Dashboard carregado com sucesso!');
            } catch (error) {
                console.error('‚ùå Erro ao carregar dashboard:', error);
            }
        });
        
        // Registration Routine Functions
        let currentRoutine = null;
        let editingItemId = null;
        
        function showRegistrationRoutine(routine) {
            currentRoutine = routine;
            
            // Hide main settings, show registration view
            document.getElementById('settings-main').classList.add('hidden');
            document.getElementById('settings-registration').classList.remove('hidden');
            
            // Update title and button text
            const titles = {
                departments: 'Departamentos',
                categories: 'Categorias de Documentos',
                positions: 'Cargos',
                tags: 'Tags Personalizadas'
            };
            
            const buttonTexts = {
                departments: 'Departamento',
                categories: 'Categoria',
                positions: 'Cargo',
                tags: 'Tag'
            };
            
            document.getElementById('routine-title').textContent = titles[routine];
            document.getElementById('new-item-text').textContent = buttonTexts[routine];
            
            // Load routine data
            loadRoutineData();
        }
        
        function backToSettings() {
            document.getElementById('settings-main').classList.remove('hidden');
            document.getElementById('settings-registration').classList.add('hidden');
            currentRoutine = null;
            editingItemId = null;
        }
        
        async function loadRoutineData() {
            if (!currentRoutine) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/${currentRoutine}?tenant=${getTenantFromUrl()}`);
                if (response.ok) {
                    const data = await response.json();
                    displayRoutineData(data);
                } else {
                    console.error('Erro ao carregar dados:', response.statusText);
                    displayRoutineData([]);
                }
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                displayRoutineData([]);
            }
        }
        
        function displayRoutineData(items) {
            const tbody = document.getElementById('routine-grid-body');
            
            if (items.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="3" style="padding: 2rem; text-align: center; color: #6b7280; font-style: italic;">
                            Nenhum ${getRoutineName()} encontrado
                        </td>
                    </tr>
                `;
                document.getElementById('grid-info').textContent = '0 resultados';
                return;
            }
            
            tbody.innerHTML = items.map(item => `
                <tr>
                    <td style="padding: 1rem; font-weight: 500;">${item.name}</td>
                    <td style="padding: 1rem; color: #6b7280;">${new Date(item.created_at).toLocaleDateString('pt-BR')}</td>
                    <td style="padding: 1rem; text-align: center;">
                        <button class="btn-edit" onclick="editItemInline('${item.id}', '${item.name.replace(/'/g, "\\'")}')">‚úèÔ∏è Editar</button>
                        <button class="btn-delete" onclick="deleteItem('${item.id}', '${item.name.replace(/'/g, "\\'")}')">üóëÔ∏è Excluir</button>
                    </td>
                </tr>
            `).join('');
            
            document.getElementById('grid-info').textContent = `${items.length} resultado(s)`;
        }
        
        function getRoutineName() {
            const names = {
                departments: 'departamento',
                categories: 'categoria',
                positions: 'cargo',
                tags: 'tag'
            };
            return names[currentRoutine] || 'item';
        }
        
        function addNewItemInline() {
            if (editingItemId) {
                cancelInlineEdit();
            }
            
            const tbody = document.getElementById('routine-grid-body');
            const newRow = document.createElement('tr');
            newRow.className = 'inline-row';
            newRow.innerHTML = `
                <td style="padding: 1rem;">
                    <input type="text" id="inlineName" placeholder="Nome do ${getRoutineName()}" style="width: 100%;">
                </td>
                <td style="padding: 1rem; color: #6b7280;">-</td>
                <td style="padding: 1rem; text-align: center;">
                    <div class="inline-actions">
                        <button class="btn-inline-save" onclick="saveInlineItem()">‚úÖ Salvar</button>
                        <button class="btn-inline-cancel" onclick="cancelInlineEdit()">‚ùå Cancelar</button>
                    </div>
                </td>
            `;
            
            tbody.insertBefore(newRow, tbody.firstChild);
            
            // Focus on input and add keyboard listeners
            const input = document.getElementById('inlineName');
            input.focus();
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    saveInlineItem();
                } else if (e.key === 'Escape') {
                    cancelInlineEdit();
                }
            });
        }
        
        function editItemInline(id, currentName) {
            if (editingItemId) {
                cancelInlineEdit();
            }
            
            editingItemId = id;
            
            // Find the row with this ID
            const rows = document.querySelectorAll('#routine-grid-body tr');
            let targetRow = null;
            
            for (let row of rows) {
                const editButton = row.querySelector('.btn-edit');
                if (editButton && editButton.onclick.toString().includes(id)) {
                    targetRow = row;
                    break;
                }
            }
            
            if (!targetRow) return;
            
            targetRow.className = 'inline-row';
            targetRow.innerHTML = `
                <td style="padding: 1rem;">
                    <input type="text" id="inlineName" value="${currentName.replace(/"/g, '&quot;')}" style="width: 100%;">
                </td>
                <td style="padding: 1rem; color: #6b7280;">-</td>
                <td style="padding: 1rem; text-align: center;">
                    <div class="inline-actions">
                        <button class="btn-inline-save" onclick="saveInlineItem()">‚úÖ Salvar</button>
                        <button class="btn-inline-cancel" onclick="cancelInlineEdit()">‚ùå Cancelar</button>
                    </div>
                </td>
            `;
            
            // Focus on input and select all text
            const input = document.getElementById('inlineName');
            input.focus();
            input.select();
            
            // Add keyboard listeners
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    saveInlineItem();
                } else if (e.key === 'Escape') {
                    cancelInlineEdit();
                }
            });
        }
        
        async function saveInlineItem() {
            const nameInput = document.getElementById('inlineName');
            const name = nameInput.value.trim();
            
            if (!name) {
                alert('Por favor, informe o nome.');
                return;
            }
            
            try {
                let response;
                
                if (editingItemId) {
                    // Update existing item
                    response = await fetch(`${API_BASE}/api/${currentRoutine}/${editingItemId}?tenant=${getTenantFromUrl()}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ name }),
                    });
                } else {
                    // Create new item
                    response = await fetch(`${API_BASE}/api/${currentRoutine}?tenant=${getTenantFromUrl()}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ name }),
                    });
                }
                
                if (response.ok) {
                    editingItemId = null;
                    loadRoutineData(); // Reload data
                } else {
                    const error = await response.json();
                    alert(`Erro: ${error.message || 'Erro desconhecido'}`);
                }
            } catch (error) {
                console.error('Erro ao salvar:', error);
                alert('Erro ao salvar. Tente novamente.');
            }
        }
        
        function cancelInlineEdit() {
            editingItemId = null;
            loadRoutineData(); // Reload to restore original state
        }
        
        async function deleteItem(id, name) {
            if (!confirm(`Tem certeza que deseja excluir "${name}"?`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/${currentRoutine}/${id}?tenant=${getTenantFromUrl()}`, {
                    method: 'DELETE',
                });
                
                if (response.ok) {
                    loadRoutineData(); // Reload data
                } else {
                    const error = await response.json();
                    alert(`Erro: ${error.message || 'Erro desconhecido'}`);
                }
            } catch (error) {
                console.error('Erro ao excluir:', error);
                alert('Erro ao excluir. Tente novamente.');
            }
        }
        
        function searchRoutineItems() {
            const searchTerm = document.getElementById('routineSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#routine-grid-body tr');
            
            rows.forEach(row => {
                const nameCell = row.querySelector('td:first-child');
                if (nameCell) {
                    const name = nameCell.textContent.toLowerCase();
                    if (name.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }
        
        function loadMoreItems() {
            // Placeholder for pagination
            console.log('Carregar mais itens...');
        }
        
        function changeItemsPerPage() {
            // Placeholder for items per page
            console.log('Alterar itens por p√°gina...');
        }
        
    </script>
    
        <!-- Chat Widget Integration (WebSocket Version) -->
        <link href="css/chat-widget.css" rel="stylesheet">
        <script>
            // Initialize chat widget for dashboard
            document.addEventListener('DOMContentLoaded', function() {
                if (window.chatWidget) {
                    // Set dashboard context
                    window.chatWidget.setUserId('admin-demo');
                    window.chatWidget.setContext({
                        page: 'dashboard',
                        userType: 'admin'
                    });
                }
            });
        </script>
        
        <!-- Feather Icons - Brand Manual -->
        <script src="https://unpkg.com/feather-icons"></script>
        <script>
            feather.replace();
        </script>
        
        <!-- Chat Widget Scripts -->
        <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="/js/supabase-client.js"></script>
    <script src="/js/chat-widget.js"></script>
        <script src="/js/chat-integration.js"></script>
</body>
</html>