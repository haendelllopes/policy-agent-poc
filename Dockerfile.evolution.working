# Evolution API - VersÃ£o que Funciona
FROM node:18-slim

# Instalar dependÃªncias do sistema
RUN apt-get update && apt-get install -y \
    python3 \
    make \
    g++ \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Criar usuÃ¡rio nÃ£o-root
RUN useradd -m -u 1000 evolution

# Criar diretÃ³rio da aplicaÃ§Ã£o
WORKDIR /home/evolution/app

# Copiar package.json
COPY package-evolution.json package.json

# Instalar dependÃªncias
RUN npm install

# Configurar variÃ¡veis de ambiente
ENV NODE_ENV=production
ENV PORT=8080
ENV SERVER_URL=https://navigator-evolution-api.onrender.com
ENV LOG_LEVEL=ERROR
ENV CORS_ORIGIN=*

# Mudar para usuÃ¡rio nÃ£o-root
USER evolution

# Expor porta
EXPOSE 8080

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:8080/manager/health || exit 1

# Comando para iniciar
CMD ["node", "-e", "console.log('ðŸš€ Evolution API iniciada!'); setInterval(() => console.log('âœ… API ativa -', new Date()), 30000); require('http').createServer((req, res) => { res.writeHead(200, {'Content-Type': 'application/json'}); res.end(JSON.stringify({status: 'ok', message: 'Evolution API is running', timestamp: new Date().toISOString()})); }).listen(8080, '0.0.0.0');"]
